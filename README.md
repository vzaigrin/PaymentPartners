# Partners of the Payment System
Проектная работа курса [Data Engineer](https://otus.ru/lessons/data-engineer/) от Otus.

Проект основан на реальной системе. Для предотвращения раскрытия коммерческой информации название сервиса и компаний-партнёров изменены.

## Задание
Сервис платёжной системы для своих партнёров. Список партнёров может меняться.

Список партнёров на текущий момент:
- Taxi
- Telecom
- Cinema
- Retail

Платёжная система предоставляет своим партнёрам программы привелегий. Партнеры предоставляют привелегии держателям карт. Партнёры загружают данные о предоставленных привилегиях держателям карт. Передача информации о привилегиях осуществляется путём загрузки в систему реестров, представляющих собой текстовые файлы в формате CSV. Партнёры загружают данные в своих форматах. Загруженные данные преобразуются к единому формату.

Отчётным периодом в системе является календарный месяц. Приём информации от партнёров по отчётному периоду длится в течение периода сбора, который начинается в первый день месяца, следующего за отчётным периодом, и длится в течение 15 дней. По истечении периода сбора расчётный период закрывается и блокируется, становясь недоступным для внесения в него каких-либо изменений. По итогам закрытия расчётного периода осуществляется формирование отчётности.

## DWH
Для моделирование DWH используется метод [Data Vault](https://en.wikipedia.org/wiki/Data_vault_modeling)

### Stage
Данные (реестры), загружаемые партнёрами, попадают в область Stage. Данные дополняются названием файла и временем загрузки:
- STG_TAXI - данные партнёра Taxi
- STG_TELECOM - данные партнёра Telecom
- STG_CINEMA - данные партнёра Cinema
- STG_RETAIL - данные партнёра Retail

### ODS
По окончании периода сбора данные из области Stage проверяются, очищаются и перегружаются в область ODS. Перегружаются только корректные записи отчётного периода:
- ODS_TAXI - данные партнёра Taxi
- ODS_TELECOM - данные партнёра Telecom
- ODS_CINEMA - данные партнёра Cinema
- ODS_RETAIL - данные партнёра Retail

### DDS
Данные из области ODS приводятся к единому формату и перегружаются в область DDS:
- Партнёры:
  - HUB_PARTNERS
  - SUB_PARTNERS
- Данные:
  - HUB_DATA
  - SUB_DATA
  - LNK_DATA_PARTNERS
  - LNK_DATA_BINS
  - LNK_DATA_OFFERS
  - LNK_DATA_PRIVILEGES
  - LNK_DATA_CAMPAIGNS
- Справочник Bins:
  - HUB_BINS
  - SUB_BINS
- Справочник предложений
  - HUB_OFFERS
  - SUB_OFFERS
- Справочник привелегий
  - HUB_PRIVILEGES
  - SUB_PRIVILEGES
- Справочник маркетинговых компаний
  - HUB_CAMPAIGNS
  - SUB_CAMPAIGNS
  - LNK_CAMPAIGNS_PARTNERS
  - LNK_CAMPAIGNS_BINS

### Data Marts
По данным из DDS строятся отчёты в области Data Marts:
- DM_PAYMENT - отчёт для платежной системы
- DM_PARTNERS - отчёт для партнёров
- V_DM_TAXI - витрина отчёта для партнёра Taxi
- V_DM_TELECOM - витрина отчёта для партнёра Telecom
- V_DM_CINEMA - витрина отчёта для партнёра Cinema
- V_DM_RETAIL - витрина отчёта для партнёра Retail

## Данные
Для предотвращения раскрытия коммерческой информации используются генерируемые синтетические данные. В справочниках коммерческие данные анонимизированы.

## Реализация
DDL сейчас разработан для Vertica. Потом система будет реализована на сервисах [Google Cloud Platform](https://cloud.google.com)
